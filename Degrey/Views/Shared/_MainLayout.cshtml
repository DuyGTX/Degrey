<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>@ViewBag.Title</title>
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/header-footer.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link href="~/Content/Font/fontawesome-free-6.4.2-web/css/all.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
    <header class="main" style="height: 90px">

        <div class="main-header" style="height:90px">
            <div class="container" style="max-width: 1140px; height: 90px">
                <div class="flex-container-header">
                    <div class="header-wrap-logo">
                        <div class="wrap-logo">
                            <a href="/Home">
                                <img style="height:auto" src="https://file.hstatic.net/1000281824/file/tote-1_33445b051a404bb790b6d0df0275ac8d.png" alt="Day la anh" class="logo" />
                            </a>






                            <div class="search" onclick="openModal()">
                                <i class="fa-solid fa-magnifying-glass" style="color: #c7c7c7; margin: 0 10px"></i>
                                <input required="" id="inputSearchAuto-3" class="search-item" name="q" maxlength="40" autocomplete="off" type="text" size="20" placeholder="Tìm kiếm sản phẩm...">
                            </div>

                            <div id="myModal" class="modal">
                                <div class="modal-content-search" style=" width: 100%;">
                                    <span style=" text-align: right;" class="close" onclick="closeModal()">&times;</span>
                                    <div class="header-search">
                                        <div class="search-box wpo-wrapper-search">
                                            <form action="/search" class="searchform-product searchform-categoris ultimate-search">

                                                <div class="wpo-search-inner">
                                                    <button type="submit" class="btn-search btn" style=" position: absolute; left: 541px; top: 23px; color: #c5cee0; ">
                                                        <i class="fa-solid fa-magnifying-glass"></i>
                                                    </button>
                                                    <input type="hidden" name="type" value="product">
                                                    <input required="" style="padding-left: 44px;" id="inputSearchAuto-3" class="input-search" name="q" maxlength="40" autocomplete="off" type="text" size="20" placeholder="Tìm kiếm sản phẩm...">
                                                </div>
                                            </form>
                                            <div id="ajaxSearchResults-3" class="smart-search-wrapper ajaxSearchResults" style="display: block;">
                                                <div class="resultsContent"></div>
                                                <div class="search-suggest show-suggest">


                                                    <p>Gợi ý cho bạn:</p>
                                                    <ul id="itemList" >
                                                        <li style="list-style-type: none;"class="item" data-category="QuanAo">
                                                            <a style="text-decoration:none;color:black" href="#" title="CLOTHES | QUẦN ÁO">CLOTHES | QUẦN ÁO</a>
                                                        </li>
                                                        <li style="list-style-type: none;"class="item" data-category="PhuKien">
                                                            <a style="text-decoration:none;color:black" href="#" title="ACCESSORIES | PHỤ KIỆN">ACCESSORIES | PHỤ KIỆN</a>
                                                        </li>
                                                        <!-- Add other items as needed -->
                                                    </ul>




                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Thêm jQuery vào trang của bạn, bạn có thể sử dụng phiên bản mới nhất -->
                            










                            <a style="text-decoration: none; color: black;" class="cart" id="btnCart">
                                <i class="cart-icon fa-solid fa-cart-shopping"></i>
                                <div class="cart-content">
                                    Giỏ hàng
                                </div>
                                <div class="count" id="count_detailorder">0</div>
                            </a>
                            <a style="text-decoration: none; color: black;" class="login" href="/Account/Register">
                                <img style="height:25px" src="~/Image/home_login.png" />
                                <div class="cart-content">
                                    Tài khoản

                                </div>

                            </a>
                        </div>
                    </div>
                    <div class="header-wrap-main">
                        <ul class="header-list">
                            <li class="list-item"><a style="text-decoration: none; color: black;"href="/Home">Trang chủ</a></li>
                            <li class="list-item"><a style="text-decoration: none; color: black;" href="/CustomerProduct/SanPham">Sản phẩm</a></li>
                            <li class="list-item"><a style="text-decoration: none; color: black;"href="/Home/Store">Store</a></li>
                            <li class="list-item"><a style="text-decoration: none; color: black;" href="/Home/GioiThieu">Giới thiệu</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>




    </header>
    <content>

        @RenderBody()

    </content>
    <footer class="main-footer">
        <div class="footer-info">
            <div class="container" style="max-width: 1140px;max-height:482px">

                <!-- Chuyển về dạng mobile -->
                <div class="contact-details">
                    <div class="container">
                        <div class="row">
                            <div class="col">
                                <div class="contact-info">
                                    <div class="contact-info-box" style="display: grid;">
                                        <span class="contact-info-text">Bán hàng 9:00 - 22:00</span>
                                        <span class="contact-info-text">
                                            <i class="fa fa-phone-square" aria-hidden="true"></i>
                                            <a>0336311117</a>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="contact-info">
                                    <div class="contact-info-box" style="display: grid;">
                                        <span class="contact-info-text">Khiếu nại 9:00 - 21:30</span>
                                        <span class="contact-info-text">
                                            <i class="fa fa-phone-square" aria-hidden="true"></i>
                                            <a>0775913335</a>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <div class="expand-button" id="expand-info">
                                    <div class="expand-button-box" onclick="toggleInfo()">
                                        <span class="expand-button-text expand-button-initial">Xem thêm thông tin</span>
                                        <span class="expand-button-icon" id="expand-icon">
                                            <i class="fa fa-angle-down" aria-hidden="true"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <script>
                    function toggleInfo() {
                        var infoBox = document.getElementById("expand-info");
                        var expandIcon = document.getElementById("expand-icon");

                        // Kiểm tra trạng thái hiển thị của thông tin mở rộng
                        if (infoBox.classList.contains("expanded")) {
                            infoBox.classList.remove("expanded");
                            expandIcon.innerHTML = '<i class="fa fa-angle-down" aria-hidden="true"></i>';
                        } else {
                            infoBox.classList.add("expanded");
                            expandIcon.innerHTML = '<i class="fa fa-angle-up" aria-hidden="true"></i>';
                        }
                    }
                </script>
                <!-- Chuyển về dạng mobile -->
                <div class="row">
                    <div class="col-md-3 col-sm-12 col-xs-12 footer-list ">
                        <h3 class="col-footer">Về DEGREY</h3>
                        <div class="col-3-item text-white"><p>Cái tên Degrey được tạo ra rất ngẫu hứng, xuất phát từ “Chuỗi ngày u buồn về sự nghiệp, tương lai trong quá khứ của chính mình” – theo lời chia sẻ của Degrey’s founder.</p></div>
                        <div class="col-3-item1 text-white">CÔNG TY TNHH DEGREY</div>
                        <div class="col-3-item text-white"><p>0315986019 0315986019 cấp ngày 31/10/2019 tại Sở kế hoạch đầu tư TPHCM</p></div>
                        <img class="logo-footer" src="https://file.hstatic.net/1000281824/file/dathongbao_22c990fc936b40e0a50a1b646f478284.png" alt="logo footer" />

                    </div>
                    <div class="col-md-3 col-sm-12 col-xs-12 footer-list-2">
                        <div class="col-3-item text-white address">Địa chỉ</div>
                        <div class="col-3-item text-white where">-Sài Gòn:</div>
                        <div class="col-3-item text-white">
                            <p>
                                43 Huỳnh Văn Bánh P.17 Q.Phú Nhuận<br>
                                1041 Luỹ Bán Bích P.Tân Thành Q.Tân Phú
                            </p>
                        </div>
                        <div class="phone col-3-item text-white">
                            <b>Điện thoại: </b>
                            0336311117
                        </div>

                        <div class="email col-3-item text-white">
                            <b>Email:  </b>
                            degrey.vn@gmail.com
                        </div>

                    </div>
                    <div class="col-md-3 col-sm-12 col-xs-12 footer-list">
                        <h3 class="col-footer">Hỗ trợ khách hàng</h3>
                        <ul class="pro-list">
                            <li><a href="GioiThieu">Giới thiệu Degrey</a></li>
                            <li><a href="Store">Hệ thống cửa hàng</a></li>
                            <li><a href="HuongDanDatHang">Hướng dẫn đặt hàng</a></li>
                            <li><a href="ChinhSachVaQuyDinh">Chính sách và quy định</a></li>
                            <li><a href="ChinhSachBaoMat">Chính sách bảo mật</a></li>
                            <li><a href="ThongTinSoHuu">Thông tin hữu ích</a></li>

                        </ul>

                    </div>
                    <div class="col-md-3 col-sm-12 col-xs-12 footer-list">
                        <h3 class="col-footer">Chăm sóc khách hàng</h3>
                        <div class="box-contact">
                            <i class="fa-solid fa-phone icon-call"></i>
                            <div class="contact">
                                <span>0336311117</span><br>
                                <u>degrey.vn@gmail.com</u>
                            </div>
                        </div>
                        <div class="footer-list-social">
                            <h4 class="col-footer1">
                                Follow Us
                            </h4>

                            <ul class="social">
                                <li><a href="#"><i class="fab fa-facebook-f"></i></a></li>
                                <li><a href="#"><i class="fab fa-twitter"></i></a></li>
                                <li><a href="#"><i class="fab fa-instagram"></i></a></li>
                                <li><a href="#"><i class="fab fa-linkedin"></i></a></li>
                                <li><a href="#"><i class="fab fa-youtube"></i></a></li>
                            </ul>


                        </div>


                    </div>
                </div>




            </div>
        </div>
    </footer>
    <div class="footer-copyright" style="max-height:45.6px">
        <div class="container">
            <p>
                Copyright © 2023 <a href="#" style="color: white;text-decoration: none;"> DEGREY VIETNAM</a>
                <a>Powered by Haravan</a>
            </p>
        </div>



    </div>

    <!-- Modal -->
    <div class="modal fade" id="staticBackdrop" data-backdrop="static" data-keyboard="false" tabindex="-1"
         aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="width: 100%;">
                <div class="modal-header" style="border-bottom: none;">
                    <h5 class="modal-title" id="staticBackdropLabel">Giỏ hàng</h5>
                    <button type="button" class="btniconclose close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <table class="show-cart table" id="cart-table" style="font-size: 14px; font-weight: 600; padding-right: 35px; text-transform: uppercase; color: #000000; ">
                        <tbody></tbody>
                    </table>
                    <div class="grand-total">Tổng tiền: <span style="font-weight: 600; font-size: 16px; color: red;" class="total-cart"></span></div>
                </div>
                <div class="modal-footer" style="border-top: none; display: flex; justify-content: center; border-top: none;">
                    
                    <div class="mini-cart__button">
                        
                        <button style="background: #ff0000;"type="button" class="btncartview btn btn-secondary">Xem giỏ hàng</button>
                    </div>
                    @*<button type="button" class="btnclose btn btn-secondary" data-dismiss="modal">Close</button>*@
                    <!-- <button type="button" class="btn btn-danger clear-all">Clear All</button> -->
                </div>
            </div>
        </div>
    </div>
</body>

</html>
<script>
    function GetDataSession(isDelete) {        
        // Đọc dữ liệu từ SessionStorage
        var tableDataJson = sessionStorage.getItem("tableData");
        // Kiểm tra xem dữ liệu đã tồn tại
        if (tableDataJson)
        {
            var total = 0;
            var count = 0;
            var tableData = JSON.parse(tableDataJson);
            tableData.forEach(function (rowData) {
                var Quantity = parseInt(rowData.quantity);
                var Price = parseInt(rowData.price);
                var productTotal = Quantity * Price;
                total += productTotal;
                count++;

                $.ajax({
                    url: "/Home/GetImageName",
                    type: "POST",
                    data: { ProductName: rowData.productName },
                    headers: {
                        RequestVerificationToken:
                            $('input:hidden[name="__RequestVerificationToken"]').val()
                    }
                }).done(function (data) {
                    var rowHtml = '<tr><td><img style="width:100px;height:100px;border: 1px solid #ededed;" src="/Image/' + data + '"/></td>' +
                        '<td>' + rowData.productName + '</td>' +
                        '<td>' + rowData.quantity + '</td>' +
                        '<td>' + rowData.price + '<span >₫</span></td>' + 
                        '<td><button class="btn btn-sm btn-danger" style="text-align:center" onclick="deleteRow(this)"><i class="fa fa-trash" aria-hidden="true"></i></button></td></tr >';
                    $('.show-cart').append(rowHtml);

                });

            });
            $('#count_detailorder').text(count);
            // Hiển thị tổng tiền
            $('.total-cart').text(total + ' ₫'); // Định dạng tổng tiền với hai số thập phân và thêm ₫
            // Ẩn thông báo nếu có sản phẩm
            $('.no-product').hide();

        } else {
            // Hiện thông báo nếu không có sản phẩm
            $('.no-product').show();
        }
    }

    


    function deleteRow(btn) {
        var row = btn.parentNode.parentNode;
        row.parentNode.removeChild(row);
        var total = 0;
        var count = 0;
        var tableData = [];
        // Lặp qua từng hàng trong bảng
        $('#cart-table tbody tr').each(function () {
            var Quantity = parseInt($(this).find('td').eq(2).text());
            var Price = parseInt($(this).find('td').eq(3).text());
            var productTotal = Quantity * Price;
            total += productTotal;
            count++;

            var rowData = {
                productImage: $(this).find('td').eq(0).text(),
                productName: $(this).find('td').eq(1).text(),
                quantity: parseInt($(this).find('td').eq(2).text()),
                price: parseFloat($(this).find('td').eq(3).text()),
            };
            tableData.push(rowData);
        });
        $('#count_detailorder').text(count);
        // Hiển thị tổng tiền
        $('.total-cart').text(total + ' ₫'); // Định dạng tổng tiền với hai số thập phân và thêm ₫

        // Chuyển dữ liệu thành chuỗi JSON
        var tableDataJson = JSON.stringify(tableData);
        // Lưu chuỗi JSON vào SessionStorage
        sessionStorage.removeItem("tableData");
        sessionStorage.setItem("tableData", tableDataJson);
        // Kiểm tra xem còn sản phẩm không
        if (tableData.length == 0) {
            // Hiện thông báo nếu không có sản phẩm
            $('.no-product').show();
        }
    }
    $(function () {
        GetDataSession(true);
        $('#btnCart').click(function () {
            $('#staticBackdrop').modal('show'); // hiện modal
        });
        $('.btnclose').click(function () {
            $('#staticBackdrop').modal('hide');
        });
        $('.btniconclose').click(function () {
            $('#staticBackdrop').modal('hide');
        });
        $('.btncartview').click(function () {
            window.location.href = '/Home/Cart';
            GetDataCardFromSession(true);
        });
    });

    //Modal search
    function openModal() {
        document.getElementById('myModal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('myModal').style.display = 'none';
    }

    // Close modal if clicked outside of modal content
    window.onclick = function (event) {
        var modal = document.getElementById('myModal');
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    }


    $(document).ready(function () {
        // Bắt sự kiện khi người dùng gửi form tìm kiếm
        $('.searchform-product').submit(function (event) {
            // Ngăn chặn sự kiện mặc định của form (không gửi yêu cầu POST)
            event.preventDefault();

            // Lấy giá trị từ ô tìm kiếm
            var searchTerm = $('#inputSearchAuto-3').val();

            // Gửi yêu cầu AJAX đến server để tìm kiếm sản phẩm
            $.ajax({
                type: 'GET',
                url: '/search', // Đổi thành đường dẫn thực tế của bạn
                data: {
                    type: 'product',
                    q: searchTerm
                },
                success: function (data) {
                    // Xử lý kết quả tìm kiếm ở đây
                    // Dữ liệu trả về từ server sẽ được lưu trong biến "data"
                    // Hiển thị kết quả, có thể làm điều này bằng cách cập nhật nội dung phần "resultsContent"
                    $('#itemList').html(data);
                },
                error: function (error) {
                    console.error('Error during search:', error);
                }
            });
        });
    });
</script>
